<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curso - Coliseum</title>
    <style>
        /* ‚úÖ ESTILOS PARA A P√ÅGINA DE CURSO */
        .curso-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .curso-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .curso-titulo {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .curso-descricao {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        .modulos-container {
            display: grid;
            gap: 20px;
        }

        .modulo-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .modulo-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .modulo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f3f4f6;
        }

        .modulo-titulo {
            font-size: 1.5rem;
            color: #1f2937;
            margin: 0;
        }

        .modulo-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .aula-count {
            background: #4f46e5;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .progresso {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .aulas-lista {
            display: grid;
            gap: 10px;
        }

        .aula-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #4f46e5;
            transition: all 0.2s ease;
        }

        .aula-item:hover {
            background: #f1f5f9;
            transform: translateX(5px);
        }

        .aula-item.concluida {
            background: #f0fdf4;
            border-left-color: #10b981;
        }

        .aula-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .aula-numero {
            background: #4f46e5;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .aula-item.concluida .aula-numero {
            background: #10b981;
        }

        .aula-detalhes {
            flex: 1;
        }

        .aula-titulo {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .aula-descricao {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .aula-meta {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .aula-duracao {
            background: #e5e7eb;
            color: #374151;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-concluida {
            color: #10b981;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .btn-aula {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .btn-aula:hover {
            background: #4338ca;
        }

        .btn-aula.concluida {
            background: #10b981;
        }

        .btn-aula.concluida:hover {
            background: #0d966c;
        }

        .sem-modulos, .erro-curso, .carregando {
            text-align: center;
            padding: 60px 40px;
            background: white;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px dashed #d1d5db;
        }

        .carregando {
            border: 2px solid #e5e7eb;
        }

        .sem-modulos h3, .erro-curso h3, .carregando h3 {
            color: #6b7280;
            margin-bottom: 15px;
        }

        .btn-tentar-novamente {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 15px;
            transition: background 0.2s;
        }

        .btn-tentar-novamente:hover {
            background: #4338ca;
        }

        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .api-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 500;
            z-index: 1000;
        }

        .api-status.online {
            background: #10b981;
            color: white;
        }

        .api-status.offline {
            background: #ef4444;
            color: white;
        }

        .api-status.fallback {
            background: #f59e0b;
            color: white;
        }
    </style>
</head>
<body>
    <div class="curso-container">
        <!-- Cabe√ßalho do Curso -->
        <div class="curso-header">
            <h1 class="curso-titulo" id="curso-titulo">Carregando curso...</h1>
            <p class="curso-descricao" id="curso-descricao">Aguarde enquanto carregamos o conte√∫do do curso.</p>
        </div>

        <!-- Container de M√≥dulos -->
        <div class="modulos-container" id="modulos-container">
            <div class="carregando">
                <div class="loading-spinner"></div>
                <h3>Carregando m√≥dulos...</h3>
                <p>Buscando conte√∫do do curso</p>
            </div>
        </div>
    </div>

    <!-- Status da API -->
    <div class="api-status" id="api-status"></div>

    <script>
        // ‚úÖ SISTEMA H√çBRIDO - API + FALLBACK AUTOM√ÅTICO
        class GerenciadorCursos {
            constructor() {
                this.API_BASE = 'https://coliseum-api.onrender.com/api';
                this.usuarioId = 1; // ID padr√£o para demonstra√ß√£o
                this.cursosFallback = this.criarDadosFallback();
            }

            criarDadosFallback() {
                return {
                    12: {
                        id: 12,
                        titulo: "In√≠cio PHP - Curso Completo",
                        descricao: "Aprenda PHP desde o b√°sico at√© conceitos avan√ßados. Desenvolva aplica√ß√µes web din√¢micas e interativas com uma das linguagens mais populares do mundo.",
                        imagem: "https://via.placeholder.com/800x400/4F46E5/FFFFFF?text=PHP+Programming",
                        ativo: true,
                        modulos: [
                            {
                                id: 1,
                                titulo: "üî∞ Introdu√ß√£o ao PHP",
                                ordem: 1,
                                aulas: [
                                    { id: 1, titulo: "O que √© PHP e para que serve?", ordem: 1, duracao: "10:00", descricao: "Conceitos b√°sicos da linguagem", concluida: false },
                                    { id: 2, titulo: "Configurando ambiente (XAMPP/WAMP)", ordem: 2, duracao: "15:00", descricao: "Preparando o ambiente de desenvolvimento", concluida: false },
                                    { id: 3, titulo: "Seu primeiro script PHP", ordem: 3, duracao: "12:00", descricao: "Hello World em PHP", concluida: false }
                                ]
                            },
                            {
                                id: 2,
                                titulo: "üí° Vari√°veis e Tipos de Dados",
                                ordem: 2,
                                aulas: [
                                    { id: 4, titulo: "Declarando e usando vari√°veis", ordem: 1, duracao: "12:00", descricao: "Sintaxe de vari√°veis em PHP", concluida: false },
                                    { id: 5, titulo: "Tipos de dados: string, int, float, boolean", ordem: 2, duracao: "18:00", descricao: "Tipos de dados fundamentais", concluida: false },
                                    { id: 6, titulo: "Arrays e manipula√ß√£o de dados", ordem: 3, duracao: "20:00", descricao: "Trabalhando com arrays", concluida: false }
                                ]
                            },
                            {
                                id: 3,
                                titulo: "‚öôÔ∏è Estruturas de Controle",
                                ordem: 3,
                                aulas: [
                                    { id: 7, titulo: "Condicionais: if, else, switch", ordem: 1, duracao: "15:00", descricao: "Tomando decis√µes no c√≥digo", concluida: false },
                                    { id: 8, titulo: "Loops: for, while, foreach", ordem: 2, duracao: "16:00", descricao: "Estruturas de repeti√ß√£o", concluida: false },
                                    { id: 9, titulo: "Exerc√≠cios pr√°ticos", ordem: 3, duracao: "25:00", descricao: "Fixando o conhecimento", concluida: false }
                                ]
                            },
                            {
                                id: 4,
                                titulo: "üöÄ Fun√ß√µes e Formul√°rios",
                                ordem: 4,
                                aulas: [
                                    { id: 10, titulo: "Criando e usando fun√ß√µes", ordem: 1, duracao: "18:00", descricao: "Organizando o c√≥digo com fun√ß√µes", concluida: false },
                                    { id: 11, titulo: "Trabalhando com formul√°rios HTML", ordem: 2, duracao: "22:00", descricao: "Processando dados de formul√°rios", concluida: false },
                                    { id: 12, titulo: "Valida√ß√£o de dados", ordem: 3, duracao: "20:00", descricao: "Validando entradas do usu√°rio", concluida: false }
                                ]
                            }
                        ]
                    }
                };
            }

            async carregarPaginaCurso() {
                const urlParams = new URLSearchParams(window.location.search);
                const cursoId = parseInt(urlParams.get('id'));
                
                console.log(`üöÄ Inicializando p√°gina do curso ${cursoId}...`);

                if (!cursoId) {
                    this.mostrarErro('ID do curso n√£o especificado na URL');
                    return;
                }

                // Mostrar estado de carregamento
                this.mostrarCarregando();

                try {
                    // Tentar carregar da API primeiro
                    await this.carregarDaAPI(cursoId);
                } catch (error) {
                    console.warn('‚ùå API offline, usando fallback:', error.message);
                    this.usarFallback(cursoId);
                    this.atualizarStatusAPI('fallback', 'Usando dados locais');
                }
            }

            async carregarDaAPI(cursoId) {
                this.atualizarStatusAPI('online', 'Conectado √† API');
                
                console.log(`üì° Tentando conectar com API...`);

                // Testar conex√£o com API primeiro
                const healthResponse = await fetch(`${this.API_BASE}/health`);
                if (!healthResponse.ok) {
                    throw new Error('API n√£o est√° respondendo');
                }

                // Carregar curso espec√≠fico
                console.log(`üìö Buscando curso ${cursoId} na API...`);
                const cursoResponse = await fetch(`${this.API_BASE}/cursos/${cursoId}`);
                
                if (cursoResponse.ok) {
                    const curso = await cursoResponse.json();
                    console.log('‚úÖ Curso carregado da API:', curso.titulo);
                    this.exibirCurso(curso);
                    
                    // Carregar m√≥dulos
                    console.log(`üìÇ Buscando m√≥dulos do curso ${cursoId}...`);
                    const modulosResponse = await fetch(`${this.API_BASE}/cursos/${cursoId}/modulos?usuarioId=${this.usuarioId}`);
                    
                    if (modulosResponse.ok) {
                        const modulos = await modulosResponse.json();
                        console.log(`‚úÖ ${modulos.length} m√≥dulos carregados da API`);
                        this.exibirModulos(modulos);
                    } else {
                        console.log('üì≠ API n√£o retornou m√≥dulos, usando fallback');
                        this.exibirModulos(curso.modulos || []);
                    }
                } else {
                    throw new Error(`Curso n√£o encontrado na API: ${cursoResponse.status}`);
                }
            }

            usarFallback(cursoId) {
                this.atualizarStatusAPI('offline', 'API offline - Modo local');
                
                const curso = this.cursosFallback[cursoId];
                
                if (curso) {
                    console.log('‚úÖ Curso carregado do fallback:', curso.titulo);
                    this.exibirCurso(curso);
                    this.exibirModulos(curso.modulos);
                } else {
                    this.mostrarErro('Curso n√£o encontrado');
                }
            }

            exibirCurso(curso) {
                const tituloElement = document.getElementById('curso-titulo');
                const descElement = document.getElementById('curso-descricao');
                
                if (tituloElement) tituloElement.textContent = curso.titulo;
                if (descElement) descElement.textContent = curso.descricao;
                
                // Atualizar t√≠tulo da p√°gina
                document.title = `${curso.titulo} - Coliseum`;
            }

            exibirModulos(modulos) {
                const container = document.getElementById('modulos-container');
                
                if (!modulos || modulos.length === 0) {
                    this.exibirSemModulos();
                    return;
                }

                let html = '';
                
                modulos.forEach((modulo, index) => {
                    const aulasConcluidas = modulo.aulas ? modulo.aulas.filter(aula => aula.concluida).length : 0;
                    const totalAulas = modulo.aulas ? modulo.aulas.length : 0;
                    const progresso = totalAulas > 0 ? Math.round((aulasConcluidas / totalAulas) * 100) : 0;
                    
                    html += `
                        <div class="modulo-card">
                            <div class="modulo-header">
                                <h3 class="modulo-titulo">${modulo.titulo}</h3>
                                <div class="modulo-info">
                                    <span class="aula-count">${totalAulas} aulas</span>
                                    <span class="progresso">${progresso}% conclu√≠do</span>
                                </div>
                            </div>
                            <div class="aulas-lista">
                                ${this.gerarListaAulas(modulo.aulas)}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }

            gerarListaAulas(aulas) {
                if (!aulas || aulas.length === 0) {
                    return '<div class="aula-item">Nenhuma aula dispon√≠vel</div>';
                }

                return aulas.map(aula => `
                    <div class="aula-item ${aula.concluida ? 'concluida' : ''}">
                        <div class="aula-info">
                            <div class="aula-numero">${aula.ordem}</div>
                            <div class="aula-detalhes">
                                <div class="aula-titulo">${aula.titulo}</div>
                                ${aula.descricao ? `<div class="aula-descricao">${aula.descricao}</div>` : ''}
                            </div>
                        </div>
                        <div class="aula-meta">
                            <span class="aula-duracao">${aula.duracao || '10:00'}</span>
                            ${aula.concluida ? '<span class="status-concluida">‚úì</span>' : ''}
                            <button class="btn-aula ${aula.concluida ? 'concluida' : ''}" 
                                    onclick="gerenciadorCursos.iniciarAula(${aula.id})">
                                ${aula.concluida ? 'Revistar' : 'Iniciar'}
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            exibirSemModulos() {
                const container = document.getElementById('modulos-container');
                container.innerHTML = `
                    <div class="sem-modulos">
                        <h3>üì≠ M√≥dulos em Desenvolvimento</h3>
                        <p>Este curso ainda n√£o possui m√≥dulos dispon√≠veis.</p>
                        <p><small>Nossa equipe est√° preparando conte√∫do de qualidade para voc√™!</small></p>
                        <button class="btn-tentar-novamente" onclick="location.reload()">
                            üîÑ Tentar Novamente
                        </button>
                    </div>
                `;
            }

            mostrarCarregando() {
                const container = document.getElementById('modulos-container');
                container.innerHTML = `
                    <div class="carregando">
                        <div class="loading-spinner"></div>
                        <h3>Carregando Conte√∫do</h3>
                        <p>Buscando informa√ß√µes do curso...</p>
                    </div>
                `;
            }

            mostrarErro(mensagem) {
                const container = document.getElementById('modulos-container');
                container.innerHTML = `
                    <div class="erro-curso">
                        <h3>‚ùå Erro ao Carregar o Curso</h3>
                        <p>${mensagem}</p>
                        <button class="btn-tentar-novamente" onclick="location.reload()">
                            üîÑ Tentar Novamente
                        </button>
                    </div>
                `;
            }

            atualizarStatusAPI(status, mensagem) {
                const statusElement = document.getElementById('api-status');
                statusElement.textContent = `API: ${mensagem}`;
                statusElement.className = `api-status ${status}`;
                
                // Auto-esconder ap√≥s 5 segundos
                setTimeout(() => {
                    statusElement.style.opacity = '0.7';
                }, 5000);
            }

            iniciarAula(aulaId) {
                console.log(`üé¨ Iniciando aula ${aulaId}`);
                // Aqui voc√™ pode implementar a l√≥gica para abrir o player de v√≠deo
                alert(`Iniciando aula ${aulaId}\n\nIntegre com seu player de v√≠deo aqui!`);
                
                // Exemplo: marcar como conclu√≠da
                // this.marcarAulaConcluida(aulaId);
            }

            async marcarAulaConcluida(aulaId) {
                try {
                    const response = await fetch(`${this.API_BASE}/progresso/aula`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            usuarioId: this.usuarioId,
                            aulaId: aulaId,
                            cursoId: this.getCursoId()
                        })
                    });
                    
                    if (response.ok) {
                        console.log('‚úÖ Progresso salvo na API');
                    }
                } catch (error) {
                    console.warn('‚ùå N√£o foi poss√≠vel salvar progresso na API');
                }
            }

            getCursoId() {
                const urlParams = new URLSearchParams(window.location.search);
                return parseInt(urlParams.get('id'));
            }
        }

        // ‚úÖ INICIALIZA√á√ÉO
        const gerenciadorCursos = new GerenciadorCursos();

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ P√°gina de curso carregada!');
            gerenciadorCursos.carregarPaginaCurso();
        });

        // ‚úÖ TESTES MANUAIS (para debug)
        window.testarAPI = async function() {
            console.log('üß™ Testando endpoints da API...');
            
            const endpoints = [
                '/health',
                '/cursos',
                '/cursos/12',
                '/cursos/12/modulos?usuarioId=1',
                '/debug/curso-12'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(`https://coliseum-api.onrender.com/api${endpoint}`);
                    const data = await response.json();
                    console.log(`‚úÖ ${endpoint}: ${response.status}`, data);
                } catch (error) {
                    console.log(`‚ùå ${endpoint}: ERROR -`, error.message);
                }
            }
        };
    </script>
</body>
</html>
