<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursos Extras - Coliseum</title>
    <meta name="description" content="Cursos extras para complementar seus estudos">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            color: #fff;
        }

        /* Header Styles */
        .header {
            width: 100%;
            max-width: 1200px;
            background: #323232;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 2px solid #444;
            margin-bottom: 30px;
            text-align: center;
        }

        h2 {
            color: #ffcf00;
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(255, 207, 0, 0.3);
        }

        .header p {
            color: #ccc;
            font-size: 1.1rem;
        }

        /* Container principal */
        .conteudo-principal {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* Stats Section */
        .stats-section {
            background: #323232;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 2px solid #444;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 12px;
            border: 1px solid #444;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #ffcf00;
        }

        .stat-value {
            color: #ffcf00;
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #ccc;
            font-size: 0.85rem;
        }

        /* Filtros */
        .filters {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 12px 20px;
            background: #2a2a2a;
            border: 2px solid #555;
            border-radius: 10px;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background: #ffcf00;
            color: #000;
            border-color: #ffcf00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 207, 0, 0.3);
        }

        /* Search */
        .search-box {
            max-width: 500px;
            margin: 0 auto 30px auto;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            background: #2a2a2a;
            border: 2px solid #555;
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: #ffcf00;
            box-shadow: 0 0 20px rgba(255, 207, 0, 0.3);
        }

        .search-box input::placeholder {
            color: #888;
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #ffcf00;
            font-size: 1.1rem;
        }

        /* Courses Grid */
        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .course-card {
            background: #323232;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 2px solid #444;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .course-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
            border-color: #ffcf00;
        }

        .course-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #ffcf00, #ff6b00);
            position: relative;
            overflow: hidden;
        }

        .course-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .course-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
            z-index: 2;
            background: rgba(0, 0, 0, 0.7);
            color: white;
        }

        .badge-matematica { background: #4361ee; }
        .badge-csn { background: #4cc9f0; }
        .badge-csh { background: #f72585; }
        .badge-portugues { background: #ffcf00; color: black; }
        .badge-programacao { background: #ff6b00; color: white; }

        .course-level {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            z-index: 2;
        }

        .level-fundamental { background: #4CAF50; }
        .level-medio { background: #FF9800; }
        .level-vestibular { background: #F44336; }

        .course-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .course-title {
            color: #ffcf00;
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: bold;
            line-height: 1.3;
        }

        .course-description {
            color: #ccc;
            margin-bottom: 15px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex: 1;
        }

        .course-meta {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .meta-value {
            color: #ffcf00;
            font-weight: bold;
            font-size: 0.9rem;
            line-height: 1.2;
        }

        .meta-label {
            color: #888;
            font-size: 0.7rem;
            margin-top: 2px;
            line-height: 1.2;
        }

        .course-category {
            margin-bottom: 12px;
        }

        .course-category small {
            color: #ffcf00;
            font-size: 0.8rem;
        }

        .course-progress {
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #444;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffcf00, #ff6b00);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            color: #aaa;
            font-size: 0.75rem;
        }

        .course-actions {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.85rem;
            min-height: 44px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffcf00, #ff6b00);
            color: #000;
        }

        .btn-secondary {
            background: #2a2a2a;
            color: #fff;
            border: 1px solid #555;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 5px 15px rgba(255, 207, 0, 0.4);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #888;
            grid-column: 1 / -1;
        }

        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: #ffcf00;
        }

        .empty-state h3 {
            color: #ffcf00;
            margin-bottom: 8px;
            font-size: 1.3rem;
        }

        .empty-state p {
            color: #ccc;
            line-height: 1.4;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            color: #ffcf00;
            grid-column: 1 / -1;
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid;
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
            border-left-color: #f44336;
        }

        .alert-success {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
            border-left-color: #4CAF50;
        }

        .alert-warning {
            background: rgba(255, 152, 0, 0.1);
            color: #FF9800;
            border-left-color: #FF9800;
        }

        .alert-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: inherit;
        }

        /* Bot√£o voltar */
        .btn-voltar {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #ffcf00;
            color: #000;
            font-size: 24px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(255, 207, 0, 0.4);
            transition: all 0.3s ease;
        }

        .btn-voltar:hover {
            background: #e6b800;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 207, 0, 0.6);
        }

        /* ========== MEDIA QUERIES ========== */
        @media (max-width: 1024px) {
            .courses-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .header {
                padding: 15px;
            }
            
            .btn-voltar {
                width: 50px;
                height: 50px;
                font-size: 20px;
                bottom: 20px;
                right: 20px;
            }
            
            .courses-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .course-actions {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 12px;
            }
            
            .stats-section {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            .filter-btn {
                padding: 10px 15px;
                font-size: 0.8rem;
            }
            
            .course-image {
                height: 160px;
            }
            
            .course-content {
                padding: 15px;
            }
            
            .course-title {
                font-size: 1.1rem;
            }
            
            .course-meta {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            /* ========== ESTILOS PARA CURSOS BLOQUEADOS ========== */
            .course-card.bloqueado {
                opacity: 0.6;
                filter: grayscale(50%);
                cursor: not-allowed;
            }
            .course-card.bloqueado:hover {
                transform: none;
                border-color: #f44336;
            }
            .course-card.bloqueado .btn-primary {
                background: linear-gradient(135deg, #f44336, #d32f2f);
                cursor: not-allowed;
            }
            .badge-bloqueado {
                background: #f44336 !important;
                color: white !important;
            }

/* ========== MEDIA QUERIES ========== */
        }
    </style>
</head>
<body>

    <div class="header">
        <h2>Cursos Extras</h2>
        <p>Aprenda com cursos complementares para refor√ßar seus estudos</p>
    </div>

    <!-- Main Content -->
    <div class="conteudo-principal">
        <!-- Alert Container -->
        <div id="alert-container"></div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-cursos">0</div>
                    <div class="stat-label">Total de Cursos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cursos-matematica">0</div>
                    <div class="stat-label">Matem√°tica</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cursos-csn">0</div>
                    <div class="stat-label">CSN</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cursos-csh">0</div>
                    <div class="stat-label">CSH</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cursos-portugues">0</div>
                    <div class="stat-label">Portugu√™s</div>
                </div>
                 <div class="stat-card">
                    <div class="stat-value" id="cursos-programacao">0</div>
                    <div class="stat-label">Programa√ß√£o</div>
                </div>
            </div>
        </div>

        <!-- Filtros por Mat√©ria -->
        <div class="filters">
            <button class="filter-btn active" data-filter="all">
                <i class="fas fa-layer-group"></i> Todas as Mat√©rias
            </button>
            <button class="filter-btn" data-filter="matematica">
                <i class="fas fa-calculator"></i> Matem√°tica
            </button>
            <button class="filter-btn" data-filter="csn">
                <i class="fas fa-flask"></i> CSN
            </button>
            <button class="filter-btn" data-filter="csh">
                <i class="fas fa-globe-americas"></i> CSH
            </button>
            <button class="filter-btn" data-filter="portugues">
                <i class="fas fa-book"></i> Portugu√™s
            </button>
            <button class="filter-btn" data-filter="programacao">
                <i class="fas fa-code"></i> Programa√ß√£o
            </button>
        </div>

        <!-- Search -->
        <div class="search-box">
            <input type="text" id="course-search" placeholder="Buscar cursos por t√≠tulo, descri√ß√£o...">
            <div class="search-icon">
                <i class="fas fa-search"></i>
            </div>
        </div>

        <!-- Courses Grid -->
        <div class="courses-grid" id="courses-container">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Carregando cursos...</p>
            </div>
        </div>
    </div>

    <button class="btn-voltar" onclick="voltarParaMenu()">‚Üê</button>

    <script>
// ‚úÖ CONSTANTES E CONFIGURA√á√ïES
const API_BASE_URL = 'https://coliseum-api.onrender.com/api';
let cursos = [];
let filteredCursos = [];

// ‚úÖ INICIALIZA√á√ÉO SIMPLIFICADA
document.addEventListener('DOMContentLoaded', async () => {
    console.log('üöÄ Inicializando p√°gina de Cursos Extras...');
    await carregarCursos();
    configurarFiltros();
    configurarBusca();
});

// ‚úÖ FUN√á√ÉO PRINCIPAL PARA CARREGAR CURSOS
async function carregarCursos() {
  try {
    mostrarLoading();
    console.log('üîÑ Carregando cursos da API...');

    // ‚úÖ OBTER ID DO USU√ÅRIO LOGADO
    const usuarioId = localStorage.getItem('usuarioId') || sessionStorage.getItem('usuarioId');
    
    // Construir URL com par√¢metro do usu√°rio
    let url = `${API_BASE_URL}/cursos`;
    if (usuarioId) {
      url += `?usuarioId=${usuarioId}`;
    }

    // Tentativa de carregamento da API
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      mode: 'cors'
    });

    if (response.ok) {
      const data = await response.json();
      
      // Verificar estrutura da resposta
      if (Array.isArray(data)) {
        cursos = data.filter(curso => curso.ativo !== false);
        console.log(`‚úÖ ${cursos.length} cursos carregados da API`);
      } else if (data.success && Array.isArray(data.cursos)) {
        cursos = data.cursos.filter(curso => curso.ativo !== false);
        console.log(`‚úÖ ${cursos.length} cursos carregados da API (formato objeto)`);
      } else {
        console.warn('‚ö†Ô∏è Formato de resposta inesperado:', data);
        cursos = [];
      }
    } else if (response.status === 403) {
      // Acesso negado espec√≠fico para um curso
      const errorData = await response.json();
      mostrarAlerta(`‚õî ${errorData.message || 'Acesso negado a este curso'}`, 'error');
      cursos = [];
    } else {
      console.warn(`‚ö†Ô∏è API retornou status ${response.status}`);
      // Usar dados de exemplo como fallback
      cursos = gerarCursosExemplo();
      mostrarAlerta('‚ö†Ô∏è Usando dados de demonstra√ß√£o. API pode estar offline.', 'warning');
    }

    // Atualizar interface
    atualizarEstatisticas();
    filtrarCursos('all');
  } catch (error) {
    console.error('‚ùå Erro ao carregar cursos:', error);
    // Fallback para dados de exemplo
    cursos = gerarCursosExemplo();
    mostrarAlerta('‚ö†Ô∏è N√£o foi poss√≠vel conectar √† API. Usando dados de demonstra√ß√£o.', 'warning');
    
    // Atualizar interface mesmo com erro
    atualizarEstatisticas();
    filtrarCursos('all');
  }
}

// ‚úÖ MOSTRAR LOADING
function mostrarLoading() {
    const container = document.getElementById('courses-container');
    if (container) {
        container.innerHTML = `
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Carregando cursos...</p>
            </div>
        `;
    }
}

// ‚úÖ ATUALIZAR ESTAT√çSTICAS
function atualizarEstatisticas() {
    const totalCursos = cursos.length;
    const cursosMatematica = cursos.filter(c => c.materia === 'matematica').length;
    const cursosCsn = cursos.filter(c => c.materia === 'csn').length;
    const cursosCsh = cursos.filter(c => c.materia === 'csh').length;
    const cursosPortugues = cursos.filter(c => c.materia === 'portugues').length;
    const cursosProgramacao = cursos.filter(c => c.materia === 'programacao').length;

    document.getElementById('total-cursos').textContent = totalCursos;
    document.getElementById('cursos-matematica').textContent = cursosMatematica;
    document.getElementById('cursos-csn').textContent = cursosCsn;
    document.getElementById('cursos-csh').textContent = cursosCsh;
    document.getElementById('cursos-portugues').textContent = cursosPortugues;
    document.getElementById('cursos-programacao').textContent = cursosProgramacao;
}

// ‚úÖ CONFIGURAR FILTROS
function configurarFiltros() {
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // Remover active de todos
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            // Adicionar active ao clicado
            this.classList.add('active');
            // Aplicar filtro
            const filtro = this.dataset.filter;
            filtrarCursos(filtro);
        });
    });
}

// ‚úÖ CONFIGURAR BUSCA
function configurarBusca() {
    const searchInput = document.getElementById('course-search');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            aplicarFiltros();
        });
    }
}

// ‚úÖ APLICAR FILTROS (filtro + busca)
function aplicarFiltros() {
    const filtroAtivo = document.querySelector('.filter-btn.active').dataset.filter;
    filtrarCursos(filtroAtivo);
}

// ‚úÖ FILTRAR CURSOS
function filtrarCursos(filtro) {
    const searchTerm = document.getElementById('course-search').value.toLowerCase();
    
    filteredCursos = cursos.filter(curso => {
        // Aplicar filtro de mat√©ria
        const passaFiltro = filtro === 'all' || curso.materia === filtro;
        
        // Aplicar filtro de busca
        const passaBusca = !searchTerm || 
            curso.titulo.toLowerCase().includes(searchTerm) ||
            (curso.descricao && curso.descricao.toLowerCase().includes(searchTerm)) ||
            (curso.categoria && curso.categoria.toLowerCase().includes(searchTerm));
        
        return passaFiltro && passaBusca;
    });
    
    exibirCursos();
}

// ‚úÖ EXIBIR CURSOS
function exibirCursos() {
    const container = document.getElementById('courses-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (filteredCursos.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-graduation-cap"></i>
                <h3>Nenhum curso encontrado</h3>
                <p>Tente alterar os filtros ou termos de busca</p>
            </div>
        `;
        return;
    }
    
    filteredCursos.forEach(curso => {
        container.appendChild(criarCardCurso(curso));
    });
}

// ‚úÖ CRIAR CARD DO CURSO
// ‚úÖ CRIAR CARD DO CURSO
function criarCardCurso(curso) {
    const card = document.createElement('div');
    
    // Verificar se o usu√°rio tem permiss√£o
    const usuarioId = localStorage.getItem('usuarioId') || sessionStorage.getItem('usuarioId');
    const usuarioCurso = localStorage.getItem('usuarioCurso') || sessionStorage.getItem('usuarioCurso');
    
    let temPermissao = true;
    if (usuarioCurso) {
        // Verifica√ß√£o simplificada no front-end (deve ser validada no back-end)
        const permissoes = {
            'matematica': ['matematica', 'programacao'],
            'csn': ['csn', 'programacao'],
            'csh': ['csh', 'portugues', 'programacao'],
            'portugues': ['portugues', 'csh', 'programacao'],
            'programacao': ['programacao']
        };
        temPermissao = permissoes[usuarioCurso]?.includes(curso.materia) || false;
    }
    
    card.className = `course-card ${!temPermissao ? 'bloqueado' : ''}`;
    
    const materiaNome = obterNomeMateria(curso.materia);
    const nivelNome = obterNomeNivel(curso.nivel);
    const progresso = obterProgressoCurso(curso.id);
    const totalAulas = calcularTotalAulas(curso);
    
    // Gerar imagem padr√£o se n√£o houver
    const corBase = getCorMateria(curso.materia);
    const imagemUrl = curso.imagem || `https://placehold.co/600x400/${corBase.replace('#', '')}/ffffff?text=${encodeURIComponent(curso.titulo.substring(0, 20))}`;
    
    card.innerHTML = `
        <div class="course-image">
            <img src="${imagemUrl}" alt="${curso.titulo}" 
                 onerror="this.src='https://placehold.co/600x400/323232/ffffff?text=${encodeURIComponent(curso.titulo.substring(0, 20))}'">
            <div class="course-badge badge-${curso.materia} ${!temPermissao ? 'badge-bloqueado' : ''}">
                ${!temPermissao ? 'üîí ' : ''}${materiaNome}
            </div>
            <div class="course-level level-${curso.nivel || 'medio'}">${nivelNome}</div>
        </div>
        
        <div class="course-content">
            <h3 class="course-title">${curso.titulo}</h3>
            <p class="course-description">${curso.descricao || 'Descri√ß√£o n√£o dispon√≠vel.'}</p>
            
            ${!temPermissao ? `
            <div class="alert" style="margin: 10px 0; padding: 10px; background: rgba(244, 67, 54, 0.1); border-left: 4px solid #f44336;">
                <small>‚õî Este curso n√£o est√° dispon√≠vel para seu curso atual</small>
            </div>
            ` : ''}
            
            <div class="course-meta">
                <div class="meta-item">
                    <div class="meta-value">${curso.duracao || '--'}</div>
                    <div class="meta-label">Horas</div>
                </div>
                <div class="meta-item">
                    <div class="meta-value">${curso.modulos ? curso.modulos.length : 0}</div>
                    <div class="meta-label">M√≥dulos</div>
                </div>
                <div class="meta-item">
                    <div class="meta-value">${totalAulas}</div>
                    <div class="meta-label">Aulas</div>
                </div>
                <div class="meta-item">
                    <div class="meta-value">${nivelNome.split(' ')[0]}</div>
                    <div class="meta-label">N√≠vel</div>
                </div>
            </div>
            
            <div class="course-category">
                <small>Categoria: ${obterNomeCategoria(curso.categoria)}</small>
            </div>
            
            ${progresso > 0 ? `
            <div class="course-progress">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progresso}%"></div>
                </div>
                <div class="progress-text">
                    <span>Progresso</span>
                    <span>${progresso}%</span>
                </div>
            </div>
            ` : ''}
            
            <div class="course-actions">
                <button class="btn ${temPermissao ? 'btn-primary' : 'btn-secondary'}" 
                        onclick="${temPermissao ? `iniciarCurso(${curso.id})` : 'mostrarAlerta(\"‚õî Este curso n√£o est√° dispon√≠vel para seu curso atual\", \"error\")'}">
                    <i class="fas ${temPermissao ? 'fa-play' : 'fa-lock'}"></i> 
                    ${temPermissao ? (progresso > 0 ? 'Continuar' : 'Come√ßar') : 'Bloqueado'}
                </button>
                
                <button class="btn btn-secondary" onclick="verDetalhes(${curso.id})">
                    <i class="fas fa-info-circle"></i> Detalhes
                </button>
            </div>
        </div>
    `;
    
    return card;
}

// ‚úÖ FUN√á√ïES AUXILIARES
function obterNomeMateria(materia) {
    const nomes = {
        'matematica': 'Matem√°tica',
        'csn': 'CSN',
        'csh': 'CSH',
        'portugues': 'Portugu√™s',
        'programacao': 'Programa√ß√£o'
    };
    return nomes[materia] || materia;
}

function obterNomeCategoria(categoria) {
    const nomes = {
        'algebra': '√Ålgebra',
        'geometria': 'Geometria',
        'quimica': 'Qu√≠mica',
        'fisica': 'F√≠sica',
        'historia': 'Hist√≥ria',
        'geografia': 'Geografia',
        'gramatica': 'Gram√°tica',
        'interpretacao': 'Interpreta√ß√£o',
        'php': 'PHP',
        'js': 'JavaScript',
        'react': 'React',
        'python': 'Python'
    };
    return nomes[categoria] || categoria;
}

function obterNomeNivel(nivel) {
    const nomes = {
        'iniciante': 'Iniciante',
        'intermediario': 'Intermedi√°rio',
        'avancado': 'Avan√ßado',
        'fundamental': 'Fundamental',
        'medio': 'Ensino M√©dio',
        'vestibular': 'Vestibular'
    };
    return nomes[nivel] || nivel || 'Ensino M√©dio';
}

function getCorMateria(materia) {
    const cores = {
        'matematica': '#4361ee',
        'csn': '#4cc9f0',
        'csh': '#f72585',
        'portugues': '#ffcf00',
        'programacao': '#ff6b00'
    };
    return cores[materia] || '#323232';
}

function calcularTotalAulas(curso) {
    if (!curso.modulos) return 0;
    let total = 0;
    curso.modulos.forEach(modulo => {
        total += modulo.aulas ? modulo.aulas.length : 0;
    });
    return total;
}

function obterProgressoCurso(cursoId) {
    return Math.random() > 0.7 ? Math.floor(Math.random() * 100) : 0;
}

async function iniciarCurso(cursoId) {
    console.log('Tentando iniciar curso:', cursoId);
        const curso = cursos.find(c => c.id === cursoId);
    if (!curso) {
        mostrarAlerta('Curso n√£o encontrado!', 'error');
        return;
    }
    
    const usuarioId = localStorage.getItem('usuarioId') || sessionStorage.getItem('usuarioId');
    
    if (usuarioId) {
        try {
            const response = await fetch(`${API_BASE_URL}/cursos/${cursoId}?usuarioId=${usuarioId}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.status === 403) {
                const errorData = await response.json();
                mostrarAlerta(`‚õî ${errorData.message}`, 'error');
                return;
            }
            
            if (response.ok) {
                window.location.href = `/cursos?id=${cursoId}`;
            } else {
                mostrarAlerta('Erro ao verificar permiss√£o do curso', 'error');
            }
        } catch (error) {
            console.error('Erro ao verificar permiss√£o:', error);
            mostrarAlerta('Erro ao verificar acesso ao curso', 'error');
        }
    } else {
        mostrarAlerta('Fa√ßa login para acessar este curso', 'warning');
    }
}

function verDetalhes(cursoId) {
    const curso = cursos.find(c => c.id === cursoId);
    if (curso) {
        const detalhes = `
üè´ ${curso.titulo}

üìö Mat√©ria: ${obterNomeMateria(curso.materia)}
üè∑Ô∏è Categoria: ${obterNomeCategoria(curso.categoria)}
üìä N√≠vel: ${obterNomeNivel(curso.nivel)}
‚è±Ô∏è Dura√ß√£o: ${curso.duracao || '--'} horas
üìÇ M√≥dulos: ${curso.modulos ? curso.modulos.length : 0}
üìù Aulas: ${calcularTotalAulas(curso)}

üìã Descri√ß√£o:
${curso.descricao || 'Sem descri√ß√£o dispon√≠vel.'}

        `;
        alert(detalhes);
    } else {
        mostrarAlerta('Curso n√£o encontrado!', 'error');
    }
}

function voltarParaMenu() {
    // Verificar se est√° no Vercel ou localhost
    const basePath = window.location.hostname.includes('vercel.app') ? '/' : '/menu';
    window.location.href = basePath;
}

function mostrarAlerta(mensagem, tipo = 'error') {
    const alertContainer = document.getElementById('alert-container');
    if (!alertContainer) return;
    
    const alert = document.createElement('div');
    alert.className = `alert alert-${tipo === 'success' ? 'success' : tipo === 'warning' ? 'warning' : 'error'}`;
    alert.innerHTML = `
        <span>${mensagem}</span>
        <button class="alert-close" onclick="this.parentElement.remove()">&times;</button>
    `;
    
    alertContainer.appendChild(alert);
    
    // Remover automaticamente ap√≥s 5 segundos
    setTimeout(() => {
        if (alert.parentElement) {
            alert.remove();
        }
    }, 5000);
}

// ‚úÖ EXPORTA FUN√á√ïES PARA USO NO HTML
window.iniciarCurso = iniciarCurso;
window.verDetalhes = verDetalhes;
window.voltarParaMenu = voltarParaMenu;
    </script>
</body>
</html>
