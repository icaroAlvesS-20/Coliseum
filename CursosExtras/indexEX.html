<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursos Extras - Coliseum</title>
    <meta name="description" content="Cursos extras para complementar seus estudos">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            color: #fff;
        }

        /* Header Styles */
        .header {
            width: 100%;
            max-width: 1200px;
            background: #323232;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 2px solid #444;
            margin-bottom: 30px;
            text-align: center;
        }

        h2 {
            color: #ffcf00;
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(255, 207, 0, 0.3);
        }

        .header p {
            color: #ccc;
            font-size: 1.1rem;
        }

        /* Container principal */
        .conteudo-principal {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* Stats Section */
        .stats-section {
            background: #323232;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 2px solid #444;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 12px;
            border: 1px solid #444;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #ffcf00;
        }

        .stat-value {
            color: #ffcf00;
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #ccc;
            font-size: 0.85rem;
        }

        /* Filtros */
        .filters {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 12px 20px;
            background: #2a2a2a;
            border: 2px solid #555;
            border-radius: 10px;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background: #ffcf00;
            color: #000;
            border-color: #ffcf00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 207, 0, 0.3);
        }

        /* Search */
        .search-box {
            max-width: 500px;
            margin: 0 auto 30px auto;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            background: #2a2a2a;
            border: 2px solid #555;
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: #ffcf00;
            box-shadow: 0 0 20px rgba(255, 207, 0, 0.3);
        }

        .search-box input::placeholder {
            color: #888;
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #ffcf00;
            font-size: 1.1rem;
        }

        /* Courses Grid */
        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .course-card {
            background: #323232;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 2px solid #444;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .course-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
            border-color: #ffcf00;
        }

        .course-card.bloqueado {
            opacity: 0.7;
            filter: grayscale(70%);
            cursor: not-allowed;
            position: relative;
        }

        .course-card.bloqueado:hover {
            transform: none !important;
            box-shadow: none !important;
            border-color: #f44336 !important;
        }

        /* Overlay de bloqueio */
        .bloqueado-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 5;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .course-card.bloqueado:hover .bloqueado-overlay {
            opacity: 1;
        }

        .bloqueado-mensagem {
            text-align: center;
            padding: 20px;
            max-width: 80%;
        }

        .bloqueado-mensagem i {
            font-size: 2.5rem;
            color: #f44336;
            margin-bottom: 15px;
        }

        .bloqueado-mensagem h4 {
            color: #f44336;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .bloqueado-mensagem p {
            color: #ccc;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .bloqueado-mensagem small {
            color: #888;
            font-size: 0.8rem;
        }

        .course-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #ffcf00, #ff6b00);
            position: relative;
            overflow: hidden;
        }

        .course-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .course-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
            z-index: 2;
            background: rgba(0, 0, 0, 0.7);
            color: white;
        }

        .badge-matematica { background: #4361ee; }
        .badge-csn { background: #4cc9f0; }
        .badge-csh { background: #f72585; }
        .badge-portugues { background: #ffcf00; color: black; }
        .badge-programacao { background: #ff6b00; color: white; }
        .badge-bloqueado {
            background: #f44336 !important;
            color: white !important;
        }

        .course-level {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            z-index: 2;
        }

        .level-fundamental { background: #4CAF50; }
        .level-medio { background: #FF9800; }
        .level-vestibular { background: #F44336; }

        .course-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .course-title {
            color: #ffcf00;
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: bold;
            line-height: 1.3;
        }

        .course-description {
            color: #ccc;
            margin-bottom: 15px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex: 1;
        }

        .course-meta {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .meta-value {
            color: #ffcf00;
            font-weight: bold;
            font-size: 0.9rem;
            line-height: 1.2;
        }

        .meta-label {
            color: #888;
            font-size: 0.7rem;
            margin-top: 2px;
            line-height: 1.2;
        }

        .course-category {
            margin-bottom: 12px;
        }

        .course-category small {
            color: #ffcf00;
            font-size: 0.8rem;
        }

        .course-progress {
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #444;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffcf00, #ff6b00);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            color: #aaa;
            font-size: 0.75rem;
        }

        .course-actions {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.85rem;
            min-height: 44px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffcf00, #ff6b00);
            color: #000;
        }

        .btn-secondary {
            background: #2a2a2a;
            color: #fff;
            border: 1px solid #555;
        }

        .btn-bloqueado {
            background: linear-gradient(135deg, #555, #333) !important;
            color: #999 !important;
            cursor: not-allowed !important;
            border: 1px solid #666 !important;
        }

        .btn-bloqueado:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 5px 15px rgba(255, 207, 0, 0.4);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #888;
            grid-column: 1 / -1;
        }

        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: #ffcf00;
        }

        .empty-state h3 {
            color: #ffcf00;
            margin-bottom: 8px;
            font-size: 1.3rem;
        }

        .empty-state p {
            color: #ccc;
            line-height: 1.4;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            color: #ffcf00;
            grid-column: 1 / -1;
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid;
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
            border-left-color: #f44336;
        }

        .alert-success {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
            border-left-color: #4CAF50;
        }

        .alert-warning {
            background: rgba(255, 152, 0, 0.1);
            color: #FF9800;
            border-left-color: #FF9800;
        }

        .alert-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: inherit;
        }

        /* Bot√£o voltar */
        .btn-voltar {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #ffcf00;
            color: #000;
            font-size: 24px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(255, 207, 0, 0.4);
            transition: all 0.3s ease;
        }

        .btn-voltar:hover {
            background: #e6b800;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 207, 0, 0.6);
        }

        /* Modal de regras */
        .modal-regras {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .modal-conteudo {
            background: #323232;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            border: 2px solid #ffcf00;
            color: white;
            text-align: center;
        }

        .modal-conteudo h3 {
            color: #ffcf00;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .modal-conteudo i {
            font-size: 3rem;
            color: #ffcf00;
            margin-bottom: 15px;
        }

        .regras-lista {
            text-align: left;
            margin: 20px 0;
            background: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
        }

        .regra-item {
            margin-bottom: 10px;
            padding: 8px;
            border-left: 3px solid #ffcf00;
            background: rgba(255, 207, 0, 0.1);
        }

        .btn-fechar-modal {
            background: #ffcf00;
            color: black;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            font-size: 1rem;
            margin-top: 15px;
        }

        /* Alert de login */
        .login-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .login-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ffcf00;
            color: black;
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(255,207,0,0.4);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Bot√£o de debug */
        .debug-btn {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #4361ee;
            color: white;
            font-size: 24px;
            border: none;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.4);
        }

        /* ========== MEDIA QUERIES ========== */
        @media (max-width: 1024px) {
            .courses-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .header {
                padding: 15px;
            }
            
            .btn-voltar {
                width: 50px;
                height: 50px;
                font-size: 20px;
                bottom: 20px;
                right: 20px;
            }
            
            .debug-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
                bottom: 80px;
                right: 20px;
            }
            
            .courses-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .course-actions {
                flex-direction: column;
            }
            
            .course-meta {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .login-alert, .login-btn {
                top: 10px;
                right: 10px;
                left: 10px;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 12px;
            }
            
            .stats-section {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            .filter-btn {
                padding: 10px 15px;
                font-size: 0.8rem;
            }
            
            .course-image {
                height: 160px;
            }
            
            .course-content {
                padding: 15px;
            }
            
            .course-title {
                font-size: 1.1rem;
            }
            
            .bloqueado-mensagem {
                padding: 15px;
            }
            
            .bloqueado-mensagem i {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>

    <div class="header">
        <h2>Cursos Extras</h2>
        <p id="header-subtitle">Aprenda com cursos complementares para refor√ßar seus estudos</p>
    </div>

    <!-- Main Content -->
    <div class="conteudo-principal">
        <!-- Alert Container -->
        <div id="alert-container"></div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-cursos">0</div>
                    <div class="stat-label">Total de Cursos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cursos-matematica">0</div>
                    <div class="stat-label">Matem√°tica</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cursos-csn">0</div>
                    <div class="stat-label">CSN</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cursos-csh">0</div>
                    <div class="stat-label">CSH</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cursos-portugues">0</div>
                    <div class="stat-label">Portugu√™s</div>
                </div>
                 <div class="stat-card">
                    <div class="stat-value" id="cursos-programacao">0</div>
                    <div class="stat-label">Programa√ß√£o</div>
                </div>
            </div>
        </div>

        <!-- Filtros por Mat√©ria -->
        <div class="filters">
            <button class="filter-btn active" data-filter="all">
                <i class="fas fa-layer-group"></i> Todas as Mat√©rias
            </button>
            <button class="filter-btn" data-filter="matematica">
                <i class="fas fa-calculator"></i> Matem√°tica
            </button>
            <button class="filter-btn" data-filter="csn">
                <i class="fas fa-flask"></i> CSN
            </button>
            <button class="filter-btn" data-filter="csh">
                <i class="fas fa-globe-americas"></i> CSH
            </button>
            <button class="filter-btn" data-filter="portugues">
                <i class="fas fa-book"></i> Portugu√™s
            </button>
            <button class="filter-btn" data-filter="programacao">
                <i class="fas fa-code"></i> Programa√ß√£o
            </button>
        </div>

        <!-- Search -->
        <div class="search-box">
            <input type="text" id="course-search" placeholder="Buscar cursos por t√≠tulo, descri√ß√£o...">
            <div class="search-icon">
                <i class="fas fa-search"></i>
            </div>
        </div>

        <!-- Courses Grid -->
        <div class="courses-grid" id="courses-container">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Carregando cursos...</p>
            </div>
        </div>
    </div>

    <button class="btn-voltar" onclick="voltarParaMenu()">‚Üê</button>
    <button class="debug-btn" onclick="debugLogin()" title="Debug Login">üêõ</button>

<script>
// ==================== SISTEMA DE LOGIN ====================

// ‚úÖ CONSTANTES
const API_BASE_URL = 'https://coliseum-api.onrender.com/api';
let cursos = [];
let filteredCursos = [];

// ‚úÖ SISTEMA DE DETEC√á√ÉO DE LOGIN
class SistemaLogin {
    constructor() {
        console.log('üîê Iniciando sistema de login...');
        this.usuarioId = null;
        this.cursoUsuario = null;
        this.usuarioNome = null;
    }

    // M√©todo principal para encontrar credenciais
    encontrarCredenciais() {
        console.log('üîç Procurando credenciais do usu√°rio...');
        
        // 1. Tentar localStorage
        this.usuarioId = localStorage.getItem('usuarioId');
        this.cursoUsuario = localStorage.getItem('cursoUsuario');
        this.usuarioNome = localStorage.getItem('usuarioNome');
        
        console.log('üìç localStorage:', {
            usuarioId: this.usuarioId,
            cursoUsuario: this.cursoUsuario,
            usuarioNome: this.usuarioNome
        });
        
        // 2. Tentar sessionStorage se n√£o encontrou
        if (!this.usuarioId) this.usuarioId = sessionStorage.getItem('usuarioId');
        if (!this.cursoUsuario) this.cursoUsuario = sessionStorage.getItem('cursoUsuario');
        if (!this.usuarioNome) this.usuarioNome = sessionStorage.getItem('usuarioNome');
        
        console.log('üìç sessionStorage:', {
            usuarioId: this.usuarioId,
            cursoUsuario: this.cursoUsuario,
            usuarioNome: this.usuarioNome
        });
        
        // 3. Tentar cookies
        this.buscarEmCookies();
        
        // 4. Tentar URL parameters
        this.buscarNaURL();
        
        // 5. Se encontrou, garantir que est√° no localStorage (para consist√™ncia)
        if (this.usuarioId && this.cursoUsuario) {
            this.salvarNoLocalStorage();
            return true;
        }
        
        console.warn('‚ö†Ô∏è Nenhuma credencial encontrada');
        return false;
    }
    
    buscarEmCookies() {
        try {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [key, value] = cookie.trim().split('=');
                if (key === 'usuarioId' && !this.usuarioId) {
                    this.usuarioId = value;
                    console.log('üç™ Usu√°rio ID encontrado em cookie:', value);
                }
                if (key === 'cursoUsuario' && !this.cursoUsuario) {
                    this.cursoUsuario = value;
                    console.log('üç™ Curso encontrado em cookie:', value);
                }
                if (key === 'usuarioNome' && !this.usuarioNome) {
                    this.usuarioNome = value;
                    console.log('üç™ Nome encontrado em cookie:', value);
                }
            }
        } catch (e) {
            console.log('‚ö†Ô∏è Erro ao ler cookies:', e.message);
        }
    }
    
    buscarNaURL() {
        const urlParams = new URLSearchParams(window.location.search);
        if (!this.usuarioId) {
            this.usuarioId = urlParams.get('usuarioId') || urlParams.get('userId');
            if (this.usuarioId) console.log('üåê Usu√°rio ID encontrado na URL:', this.usuarioId);
        }
        if (!this.cursoUsuario) {
            this.cursoUsuario = urlParams.get('curso') || urlParams.get('cursoUsuario') || urlParams.get('materia');
            if (this.cursoUsuario) console.log('üåê Curso encontrado na URL:', this.cursoUsuario);
        }
        if (!this.usuarioNome) {
            this.usuarioNome = urlParams.get('nome') || urlParams.get('usuarioNome') || urlParams.get('username');
            if (this.usuarioNome) console.log('üåê Nome encontrado na URL:', this.usuarioNome);
        }
    }
    
    salvarNoLocalStorage() {
        console.log('üíæ Salvando credenciais no localStorage...');
        localStorage.setItem('usuarioId', this.usuarioId);
        localStorage.setItem('cursoUsuario', this.cursoUsuario);
        if (this.usuarioNome) {
            localStorage.setItem('usuarioNome', this.usuarioNome);
        }
        
        console.log('‚úÖ Credenciais salvas:', {
            usuarioId: this.usuarioId,
            cursoUsuario: this.cursoUsuario,
            usuarioNome: this.usuarioNome
        });
    }
    
    estaLogado() {
        return !!(this.usuarioId && this.cursoUsuario);
    }
    
    mostrarStatusLogin() {
        if (this.estaLogado()) {
            this.mostrarAlertaLogin();
            this.atualizarCabecalho();
        } else {
            this.mostrarBotaoLogin();
        }
    }
    
    mostrarAlertaLogin() {
        // Remover alerta anterior se existir
        const alertaAnterior = document.querySelector('.login-alert');
        if (alertaAnterior) alertaAnterior.remove();
        
        const alertDiv = document.createElement('div');
        alertDiv.className = 'login-alert';
        alertDiv.innerHTML = `
            <i class="fas fa-check-circle"></i> 
            <span>Logado como: <strong>${this.usuarioNome || 'Usu√°rio'}</strong> (${this.cursoUsuario.toUpperCase()})</span>
            <button onclick="this.parentElement.remove()" style="
                background: none;
                border: none;
                color: white;
                margin-left: 10px;
                cursor: pointer;
                font-size: 1.2rem;
            ">√ó</button>
        `;
        
        document.body.appendChild(alertDiv);
        
        // Remover ap√≥s 5 segundos
        setTimeout(() => {
            if (alertDiv.parentElement) {
                alertDiv.remove();
            }
        }, 5000);
    }
    
    mostrarBotaoLogin() {
        // Remover bot√£o anterior se existir
        const botaoAnterior = document.querySelector('.login-btn');
        if (botaoAnterior) botaoAnterior.remove();
        
        const loginBtn = document.createElement('button');
        loginBtn.className = 'login-btn';
        loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Fazer Login';
        loginBtn.onclick = () => window.location.href = this.getLoginUrl();
        
        document.body.appendChild(loginBtn);
    }
    
    atualizarCabecalho() {
        const headerSubtitle = document.getElementById('header-subtitle');
        if (headerSubtitle && this.usuarioNome && this.cursoUsuario) {
            const originalText = 'Aprenda com cursos complementares para refor√ßar seus estudos';
            headerSubtitle.innerHTML = `${originalText}<br>
                <small style="color: #ffcf00; font-size: 0.9rem;">
                    üë§ ${this.usuarioNome} - Curso: ${this.cursoUsuario.toUpperCase()}
                </small>`;
        }
    }
    
    getLoginUrl() {
        // Verificar se est√° no Vercel ou localhost
        const isVercel = window.location.hostname.includes('vercel.app');
        return isVercel ? '/login.html' : '/login.html';
    }
}

// ‚úÖ INSTANCIAR SISTEMA DE LOGIN
const sistemaLogin = new SistemaLogin();

// ==================== FUN√á√ïES PRINCIPAIS ====================

// ‚úÖ INICIALIZA√á√ÉO
document.addEventListener('DOMContentLoaded', async () => {
    console.log('üöÄ Inicializando p√°gina de Cursos Extras...');
    
    // Verificar login
    const logado = sistemaLogin.encontrarCredenciais();
    sistemaLogin.mostrarStatusLogin();
    
    // Carregar cursos
    await carregarCursos();
    configurarFiltros();
    configurarBusca();
    
    // Mostrar debug info
    console.log('üìä Status final do login:', {
        logado: logado,
        usuarioId: sistemaLogin.usuarioId,
        cursoUsuario: sistemaLogin.cursoUsuario,
        usuarioNome: sistemaLogin.usuarioNome
    });
});

// ‚úÖ FUN√á√ÉO PRINCIPAL PARA CARREGAR CURSOS
async function carregarCursos() {
  try {
    mostrarLoading();
    console.log('üîÑ Carregando cursos da API...');

    // ‚úÖ OBTER ID DO USU√ÅRIO LOGADO
    const usuarioId = sistemaLogin.usuarioId;
    
    // Construir URL com par√¢metro do usu√°rio
    let url = `${API_BASE_URL}/cursos`;
    if (usuarioId) {
      url += `?usuarioId=${usuarioId}`;
    }

    console.log('üåê Chamando API:', url);
    
    // Tentativa de carregamento da API
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      mode: 'cors',
      credentials: 'include'
    });

    console.log('üì° Resposta da API:', {
      status: response.status,
      ok: response.ok,
      url: response.url
    });

    if (response.ok) {
      const data = await response.json();
      console.log('üì¶ Dados recebidos da API:', data);
      
      // Verificar estrutura da resposta
      if (Array.isArray(data)) {
        cursos = data.filter(curso => curso.ativo !== false);
        console.log(`‚úÖ ${cursos.length} cursos carregados da API`);
      } else if (data.success && Array.isArray(data.cursos)) {
        cursos = data.cursos.filter(curso => curso.ativo !== false);
        console.log(`‚úÖ ${cursos.length} cursos carregados da API (formato objeto)`);
      } else if (data.curso) {
        // Se for um √∫nico curso
        cursos = [data.curso].filter(curso => curso.ativo !== false);
        console.log(`‚úÖ 1 curso carregado da API`);
      } else {
        console.warn('‚ö†Ô∏è Formato de resposta inesperado:', data);
        cursos = gerarCursosExemplo();
      }
    } else if (response.status === 403) {
      // Acesso negado espec√≠fico para um curso
      const errorData = await response.json().catch(() => ({}));
      console.error('‚õî Acesso negado:', errorData);
      cursos = gerarCursosExemplo();
      mostrarAlerta(`‚õî ${errorData.message || 'Acesso negado a alguns cursos'}`, 'error');
    } else {
      console.warn(`‚ö†Ô∏è API retornou status ${response.status}`);
      // Usar dados de exemplo como fallback
      cursos = gerarCursosExemplo();
      mostrarAlerta('‚ö†Ô∏è Usando dados de demonstra√ß√£o. API pode estar offline.', 'warning');
    }

    // Debug dos dados carregados
    console.log('üìä Cursos carregados:', cursos);
    
    // Atualizar interface
    atualizarEstatisticas();
    filtrarCursos('all');
    
  } catch (error) {
    console.error('‚ùå Erro ao carregar cursos:', error);
    // Fallback para dados de exemplo
    cursos = gerarCursosExemplo();
    mostrarAlerta('‚ö†Ô∏è N√£o foi poss√≠vel conectar √† API. Usando dados de demonstra√ß√£o.', 'warning');
    
    // Atualizar interface mesmo com erro
    atualizarEstatisticas();
    filtrarCursos('all');
  }
}

// ‚úÖ GERAR CURSOS DE EXEMPLO (FALLBACK)
function gerarCursosExemplo() {
    return [
        {
            id: 1,
            titulo: "√Ålgebra Linear B√°sica",
            descricao: "Aprenda os fundamentos da √°lgebra linear para resolu√ß√£o de problemas matem√°ticos.",
            materia: "algebra",
            categoria: "matematica",
            nivel: "medio",
            duracao: 20,
            imagem: null,
            ativo: true,
            modulos: [{ aulas: [{}] }, { aulas: [{}] }]
        },
        {
            id: 2,
            titulo: "Qu√≠mica Org√¢nica",
            descricao: "Estudo dos compostos de carbono e suas aplica√ß√µes no cotidiano.",
            materia: "quimica",
            categoria: "csn",
            nivel: "medio",
            duracao: 25,
            imagem: null,
            ativo: true,
            modulos: [{ aulas: [{}] }]
        },
        {
            id: 3,
            titulo: "Hist√≥ria do Brasil",
            descricao: "Panorama hist√≥rico do Brasil desde o descobrimento at√© os dias atuais.",
            materia: "historia",
            categoria: "csh",
            nivel: "medio",
            duracao: 30,
            imagem: null,
            ativo: true,
            modulos: [{ aulas: [{}] }, { aulas: [{}] }, { aulas: [{}] }]
        },
        {
            id: 4,
            titulo: "Gram√°tica Avan√ßada",
            descricao: "Aprofunde seus conhecimentos em gram√°tica portuguesa.",
            materia: "gramatica",
            categoria: "portugues",
            nivel: "avancado",
            duracao: 18,
            imagem: null,
            ativo: true,
            modulos: [{ aulas: [{}] }, { aulas: [{}] }]
        },
        {
            id: 5,
            titulo: "Introdu√ß√£o ao JavaScript",
            descricao: "Aprenda os fundamentos da programa√ß√£o com JavaScript.",
            materia: "js",
            categoria: "programacao",
            nivel: "iniciante",
            duracao: 15,
            imagem: null,
            ativo: true,
            modulos: [{ aulas: [{}] }]
        },
        {
            id: 6,
            titulo: "F√≠sica Moderna",
            descricao: "Conceitos avan√ßados de f√≠sica qu√¢ntica e relatividade.",
            materia: "fisica",
            categoria: "csn",
            nivel: "avancado",
            duracao: 35,
            imagem: null,
            ativo: true,
            modulos: [{ aulas: [{}] }, { aulas: [{}] }]
        },
        {
            id: 7,
            titulo: "Geografia Mundial",
            descricao: "Estudo dos aspectos f√≠sicos e humanos da Terra.",
            materia: "geografia",
            categoria: "csh",
            nivel: "medio",
            duracao: 22,
            imagem: null,
            ativo: true,
            modulos: [{ aulas: [{}] }, { aulas: [{}] }]
        }
    ];
}

// ‚úÖ MOSTRAR LOADING
function mostrarLoading() {
    const container = document.getElementById('courses-container');
    if (container) {
        container.innerHTML = `
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Carregando cursos...</p>
            </div>
        `;
    }
}

// ‚úÖ ATUALIZAR ESTAT√çSTICAS
function atualizarEstatisticas() {
    const totalCursos = cursos.length;
    const cursosMatematica = cursos.filter(c => c.categoria === 'matematica').length;
    const cursosCsn = cursos.filter(c => c.categoria === 'csn').length;
    const cursosCsh = cursos.filter(c => c.categoria === 'csh').length;
    const cursosPortugues = cursos.filter(c => c.categoria === 'portugues').length;
    const cursosProgramacao = cursos.filter(c => c.categoria === 'programacao').length;

    document.getElementById('total-cursos').textContent = totalCursos;
    document.getElementById('cursos-matematica').textContent = cursosMatematica;
    document.getElementById('cursos-csn').textContent = cursosCsn;
    document.getElementById('cursos-csh').textContent = cursosCsh;
    document.getElementById('cursos-portugues').textContent = cursosPortugues;
    document.getElementById('cursos-programacao').textContent = cursosProgramacao;
}

// ‚úÖ CONFIGURAR FILTROS
function configurarFiltros() {
    console.log('üîß Configurando filtros...');
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            console.log(`üéØ Bot√£o de filtro clicado: ${this.dataset.filter}`);
            
            // Remover active de todos
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            // Adicionar active ao clicado
            this.classList.add('active');
            // Aplicar filtro
            const filtro = this.dataset.filter;
            filtrarCursos(filtro);
        });
    });
}

// ‚úÖ CONFIGURAR BUSCA
function configurarBusca() {
    const searchInput = document.getElementById('course-search');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            console.log(`üîç Busca digitada: ${this.value}`);
            aplicarFiltros();
        });
    }
}

// ‚úÖ APLICAR FILTROS (filtro + busca)
function aplicarFiltros() {
    const filtroAtivo = document.querySelector('.filter-btn.active').dataset.filter;
    console.log(`üîÑ Aplicando filtros: ${filtroAtivo}`);
    filtrarCursos(filtroAtivo);
}

// ‚úÖ FILTRAR CURSOS
function filtrarCursos(filtro) {
    try {
        console.log(`üîç Aplicando filtro: "${filtro}"`);
        console.log(`üìä Total de cursos dispon√≠veis: ${cursos.length}`);
        
        const searchInput = document.getElementById('course-search');
        const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
        
        if (!Array.isArray(cursos) || cursos.length === 0) {
            console.warn('‚ö†Ô∏è Nenhum curso dispon√≠vel para filtrar');
            exibirCursos();
            return;
        }
        
        // Debug: mostrar categorias dispon√≠veis
        const categoriasDisponiveis = [...new Set(cursos.map(c => c.categoria).filter(Boolean))];
        console.log('üè∑Ô∏è Categorias dispon√≠veis nos cursos:', categoriasDisponiveis);
        
        // Filtrar cursos
        filteredCursos = cursos.filter(curso => {
            if (!curso || typeof curso !== 'object') return false;
            
            // 1. Aplicar filtro de categoria
            let passaFiltro = true;
            if (filtro !== 'all') {
                // Verificar se a categoria do curso corresponde ao filtro
                passaFiltro = curso.categoria === filtro;
                if (!passaFiltro) {
                    return false; // J√° falhou no filtro principal
                }
            }
            
            // 2. Aplicar filtro de busca
            if (searchTerm) {
                // Verificar em todos os campos de texto
                const camposParaBuscar = [
                    curso.titulo || '',
                    curso.descricao || '',
                    curso.materia || '',
                    curso.categoria || '',
                    curso.nivel || ''
                ];
                
                const encontrou = camposParaBuscar.some(campo => 
                    campo.toLowerCase().includes(searchTerm)
                );
                
                if (!encontrou) {
                    return false; // N√£o encontrou na busca
                }
            }
            
            return true; // Passou em todos os filtros
        });
        
        console.log(`‚úÖ Filtro "${filtro}" aplicado: ${filteredCursos.length} cursos encontrados`);
        
        // Mostrar quais cursos foram encontrados
        if (filteredCursos.length > 0) {
            console.log('üìã Cursos encontrados:');
            filteredCursos.forEach((curso, i) => {
                console.log(`  ${i+1}. "${curso.titulo}" (Categoria: ${curso.categoria})`);
            });
        }
        
        exibirCursos();
        
    } catch (error) {
        console.error('‚ùå Erro ao filtrar cursos:', error);
        mostrarAlerta('Erro ao filtrar cursos. Tente novamente.', 'error');
    }
}

// ‚úÖ EXIBIR CURSOS
function exibirCursos() {
    const container = document.getElementById('courses-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (filteredCursos.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-graduation-cap"></i>
                <h3>Nenhum curso encontrado</h3>
                <p>Tente alterar os filtros ou termos de busca</p>
            </div>
        `;
        return;
    }
    
    console.log(`üé® Exibindo ${filteredCursos.length} cursos na tela`);
    
    filteredCursos.forEach(curso => {
        container.appendChild(criarCardCurso(curso));
    });
}

// ‚úÖ CRIAR CARD DO CURSO - COM VERIFICA√á√ÉO DE PERMISS√ÉO
function criarCardCurso(curso) {
    const card = document.createElement('div');
    
    // ‚úÖ VERIFICAR PERMISS√ÉO DO USU√ÅRIO
    const usuarioId = sistemaLogin.usuarioId;
    const cursoUsuario = sistemaLogin.cursoUsuario;
    
    let temPermissao = false;
    let mensagemBloqueio = '';
    
    console.log(`üîê Verificando permiss√£o para curso: ${curso.titulo}`);
    console.log(`   Usu√°rio ID: ${usuarioId}`);
    console.log(`   Curso do usu√°rio: ${cursoUsuario}`);
    console.log(`   Categoria do curso: ${curso.categoria}`);
    
    if (usuarioId && cursoUsuario) {
        temPermissao = verificarPermissaoFrontend(cursoUsuario, curso.categoria);
        console.log(`   Permiss√£o concedida: ${temPermissao}`);
        
        if (!temPermissao) {
            mensagemBloqueio = `
                <div class="bloqueado-overlay">
                    <div class="bloqueado-mensagem">
                        <i class="fas fa-lock"></i>
                        <h4>Curso Bloqueado</h4>
                        <p>Voc√™ √© do curso <strong>${cursoUsuario.toUpperCase()}</strong> 
                           e n√£o pode acessar cursos de <strong>${obterNomeCategoria(curso.categoria)}</strong>.</p>
                        <small>Clique em "Ver Regras" para mais informa√ß√µes.</small>
                    </div>
                </div>
            `;
        }
    } else {
        // Se n√£o tem usu√°rio logado, mostrar mensagem diferente
        temPermissao = false;
        mensagemBloqueio = `
            <div class="bloqueado-overlay">
                <div class="bloqueado-mensagem">
                    <i class="fas fa-user-lock"></i>
                    <h4>Login Necess√°rio</h4>
                    <p>Fa√ßa login para acessar este curso.</p>
                    <button onclick="irParaLogin()" style="
                        background: #ffcf00;
                        color: black;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 5px;
                        margin-top: 10px;
                        cursor: pointer;
                        font-weight: bold;
                    ">
                        <i class="fas fa-sign-in-alt"></i> Fazer Login
                    </button>
                </div>
            </div>
        `;
    }
    
    card.className = `course-card ${temPermissao ? '' : 'bloqueado'}`;
    
    const materiaNome = obterNomeMateria(curso.materia);
    const categoriaNome = obterNomeCategoria(curso.categoria);
    const nivelNome = obterNomeNivel(curso.nivel);
    const progresso = obterProgressoCurso(curso.id);
    const totalAulas = calcularTotalAulas(curso);
    
    // Gerar imagem padr√£o se n√£o houver
    const corBase = getCorMateria(curso.categoria);
    const imagemUrl = curso.imagem || `https://placehold.co/600x400/${corBase.replace('#', '')}/ffffff?text=${encodeURIComponent(curso.titulo.substring(0, 20))}`;
    
    card.innerHTML = `
        ${mensagemBloqueio}
        
        <div class="course-image">
            <img src="${imagemUrl}" alt="${curso.titulo}" 
                 onerror="this.src='https://placehold.co/600x400/323232/ffffff?text=${encodeURIComponent(curso.titulo.substring(0, 20))}'">
            <div class="course-badge ${temPermissao ? `badge-${curso.categoria}` : 'badge-bloqueado'}">
                ${temPermissao ? categoriaNome : 'BLOQUEADO'}
            </div>
            <div class="course-level level-${curso.nivel || 'medio'}">${nivelNome}</div>
        </div>
        
        <div class="course-content">
            <h3 class="course-title">${curso.titulo}</h3>
            <p class="course-description">${curso.descricao || 'Descri√ß√£o n√£o dispon√≠vel.'}</p>
            
            <div class="course-meta">
                <div class="meta-item">
                    <div class="meta-value">${curso.duracao || '--'}</div>
                    <div class="meta-label">Horas</div>
                </div>
                <div class="meta-item">
                    <div class="meta-value">${curso.modulos ? curso.modulos.length : 0}</div>
                    <div class="meta-label">M√≥dulos</div>
                </div>
                <div class="meta-item">
                    <div class="meta-value">${totalAulas}</div>
                    <div class="meta-label">Aulas</div>
                </div>
                <div class="meta-item">
                    <div class="meta-value">${nivelNome.split(' ')[0]}</div>
                    <div class="meta-label">N√≠vel</div>
                </div>
            </div>
            
            <div class="course-category">
                <small>Mat√©ria: ${materiaNome}</small>
                ${!temPermissao && usuarioId ? `
                    <br><small style="color: #f44336;">
                        <i class="fas fa-ban"></i> 
                        Acesso restrito para ${cursoUsuario.toUpperCase()}
                    </small>
                ` : ''}
            </div>
            
            ${progresso > 0 ? `
            <div class="course-progress">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progresso}%"></div>
                </div>
                <div class="progress-text">
                    <span>Progresso</span>
                    <span>${progresso}%</span>
                </div>
            </div>
            ` : ''}
            
            <div class="course-actions">
                <button class="btn ${temPermissao ? 'btn-primary' : 'btn-bloqueado'}" 
                        onclick="${temPermissao ? `iniciarCurso(${curso.id})` : 'mostrarModalRegras()'}"
                        ${!temPermissao ? 'disabled' : ''}>
                    <i class="fas ${temPermissao ? 'fa-play' : 'fa-lock'}"></i> 
                    ${temPermissao ? (progresso > 0 ? 'Continuar' : 'Come√ßar') : 'Bloqueado'}
                </button>
                
                ${!temPermissao && usuarioId ? `
                <button class="btn btn-secondary" onclick="mostrarModalRegras()">
                    <i class="fas fa-info-circle"></i> Ver Regras
                </button>
                ` : `
                <button class="btn btn-secondary" onclick="verDetalhes(${curso.id})">
                    <i class="fas fa-info-circle"></i> Detalhes
                </button>
                `}
            </div>
        </div>
    `;
    
    return card;
}

// ‚úÖ FUN√á√ÉO DE VERIFICA√á√ÉO NO FRONTEND
function verificarPermissaoFrontend(cursoUsuario, materiaCurso) {
    const mapeamentoCursos = {
        // Se o usu√°rio √© de "matematica", pode acessar:
        'matematica': ['matematica', 'programacao'],
        
        // Se o usu√°rio √© de "csn", pode acessar:
        'csn': ['csn', 'programacao'],
        
        // Se o usu√°rio √© de "csh", pode acessar:
        'csh': ['csh', 'portugues', 'programacao'],
        
        // Se o usu√°rio √© de "portugues", pode acessar:
        'portugues': ['portugues', 'csh', 'programacao'],
        
        // Se o usu√°rio √© de "programacao", pode acessar:
        'programacao': ['programacao']
    };
    
    const permitido = mapeamentoCursos[cursoUsuario]?.includes(materiaCurso) || false;
    console.log(`üîê Permiss√£o: ${cursoUsuario} ‚Üí ${materiaCurso} = ${permitido ? '‚úÖ' : '‚ùå'}`);
    return permitido;
}

// ‚úÖ INICIAR CURSO COM VALIDA√á√ÉO
async function iniciarCurso(cursoId) {
    console.log('üéØ Tentando iniciar curso:', cursoId);
    const curso = cursos.find(c => c.id === cursoId);
    if (!curso) {
        mostrarAlerta('Curso n√£o encontrado!', 'error');
        return;
    }
    
    // ‚úÖ VERIFICA√á√ÉO FINAL ANTES DE ACESSAR
    const usuarioId = sistemaLogin.usuarioId;
    const cursoUsuario = sistemaLogin.cursoUsuario;
    
    if (!usuarioId || !cursoUsuario) {
        mostrarAlerta('Fa√ßa login para acessar os cursos!', 'warning');
        irParaLogin();
        return;
    }
    
    if (!verificarPermissaoFrontend(cursoUsuario, curso.categoria)) {
        mostrarAlerta(
            `‚õî Acesso Negado! Voc√™ √© do curso ${cursoUsuario.toUpperCase()} e n√£o pode acessar cursos de ${obterNomeCategoria(curso.categoria)}.`,
            'error'
        );
        return;
    }
    
    // ‚úÖ ACESSO PERMITIDO
    console.log(`‚úÖ Acesso permitido ao curso: ${curso.titulo}`);
    mostrarAlerta(`Redirecionando para o curso: ${curso.titulo}`, 'success');
    
    // Redirecionar para a p√°gina do curso
    setTimeout(() => {
        window.location.href = `/curso-detailed.html?id=${cursoId}&usuarioId=${usuarioId}`;
    }, 1000);
}

// ‚úÖ FUN√á√ïES AUXILIARES
function obterNomeMateria(materia) {
    const nomes = {
        'algebra': '√Ålgebra',
        'geometria': 'Geometria',
        'quimica': 'Qu√≠mica',
        'fisica': 'F√≠sica',
        'historia': 'Hist√≥ria',
        'geografia': 'Geografia',
        'gramatica': 'Gram√°tica',
        'interpretacao': 'Interpreta√ß√£o',
        'php': 'PHP',
        'js': 'JavaScript',
        'react': 'React',
        'python': 'Python',
        'matematica': 'Matem√°tica'
    };
    return nomes[materia] || materia;
}

function obterNomeCategoria(categoria) {
    const nomes = {
        'matematica': 'Matem√°tica',
        'csn': 'CSN',
        'csh': 'CSH',
        'portugues': 'Portugu√™s',
        'programacao': 'Programa√ß√£o'
    };
    return nomes[categoria] || categoria;
}

function obterNomeNivel(nivel) {
    const nomes = {
        'iniciante': 'Iniciante',
        'intermediario': 'Intermedi√°rio',
        'avancado': 'Avan√ßado',
        'fundamental': 'Fundamental',
        'medio': 'Ensino M√©dio',
        'vestibular': 'Vestibular'
    };
    return nomes[nivel] || nivel || 'Ensino M√©dio';
}

function getCorMateria(categoria) {
    const cores = {
        'matematica': '#4361ee',
        'csn': '#4cc9f0',
        'csh': '#f72585',
        'portugues': '#ffcf00',
        'programacao': '#ff6b00'
    };
    return cores[categoria] || '#323232';
}

function calcularTotalAulas(curso) {
    if (!curso.modulos) return 0;
    let total = 0;
    curso.modulos.forEach(modulo => {
        total += modulo.aulas ? modulo.aulas.length : 0;
    });
    return total;
}

function obterProgressoCurso(cursoId) {
    // Simula progresso - na implementa√ß√£o real, buscar do localStorage ou API
    const progressoSalvo = localStorage.getItem(`progresso_curso_${cursoId}`);
    return progressoSalvo ? parseInt(progressoSalvo) : 0;
}

function verDetalhes(cursoId) {
    const curso = cursos.find(c => c.id === cursoId);
    if (curso) {
        const detalhes = `
üè´ ${curso.titulo}

üìö Mat√©ria: ${obterNomeMateria(curso.materia)}
üè∑Ô∏è Categoria: ${obterNomeCategoria(curso.categoria)}
üìä N√≠vel: ${obterNomeNivel(curso.nivel)}
‚è±Ô∏è Dura√ß√£o: ${curso.duracao || '--'} horas
üìÇ M√≥dulos: ${curso.modulos ? curso.modulos.length : 0}
üìù Aulas: ${calcularTotalAulas(curso)}

üìã Descri√ß√£o:
${curso.descricao || 'Sem descri√ß√£o dispon√≠vel.'}
        `;
        alert(detalhes);
    } else {
        mostrarAlerta('Curso n√£o encontrado!', 'error');
    }
}

function voltarParaMenu() {
    // Verificar se est√° no Vercel ou localhost
    const isVercel = window.location.hostname.includes('vercel.app');
    const basePath = isVercel ? '/' : '/menu.html';
    window.location.href = basePath;
}

function irParaLogin() {
    console.log('üîê Redirecionando para p√°gina de login...');
    const isVercel = window.location.hostname.includes('vercel.app');
    const loginPath = isVercel ? '/login.html' : '/login.html';
    window.location.href = loginPath;
}

function mostrarAlerta(mensagem, tipo = 'error') {
    const alertContainer = document.getElementById('alert-container');
    if (!alertContainer) return;
    
    const alert = document.createElement('div');
    alert.className = `alert alert-${tipo === 'success' ? 'success' : tipo === 'warning' ? 'warning' : 'error'}`;
    alert.innerHTML = `
        <span>${mensagem}</span>
        <button class="alert-close" onclick="this.parentElement.remove()">&times;</button>
    `;
    
    alertContainer.appendChild(alert);
    
    // Remover automaticamente ap√≥s 5 segundos
    setTimeout(() => {
        if (alert.parentElement) {
            alert.remove();
        }
    }, 5000);
}

// ‚úÖ MODAL DE REGRAS DE ACESSO
function mostrarModalRegras() {
    const cursoUsuario = sistemaLogin.cursoUsuario;
    const usuarioNome = sistemaLogin.usuarioNome || 'Usu√°rio';
    
    const regras = {
        'matematica': [
            'Pode acessar cursos de: Matem√°tica',
            'Pode acessar cursos de: Programa√ß√£o',
            'N√£o pode acessar cursos de: CSN, CSH, Portugu√™s (exceto os permitidos)'
        ],
        'csn': [
            'Pode acessar cursos de: CSN (Ci√™ncias da Natureza)',
            'Pode acessar cursos de: Programa√ß√£o',
            'N√£o pode acessar cursos de: Matem√°tica, CSH, Portugu√™s (exceto os permitidos)'
        ],
        'csh': [
            'Pode acessar cursos de: CSH (Ci√™ncias Humanas)',
            'Pode acessar cursos de: Portugu√™s',
            'Pode acessar cursos de: Programa√ß√£o',
            'N√£o pode acessar cursos de: Matem√°tica, CSN (exceto os permitidos)'
        ],
        'portugues': [
            'Pode acessar cursos de: Portugu√™s',
            'Pode acessar cursos de: CSH',
            'Pode acessar cursos de: Programa√ß√£o',
            'N√£o pode acessar cursos de: Matem√°tica, CSN (exceto os permitidos)'
        ],
        'programacao': [
            'Pode acessar cursos de: Programa√ß√£o',
            'N√£o pode acessar cursos de: Matem√°tica, CSN, CSH, Portugu√™s (exceto os permitidos)'
        ]
    };
    
    const modal = document.createElement('div');
    modal.className = 'modal-regras';
    modal.innerHTML = `
        <div class="modal-conteudo">
            <i class="fas fa-lock"></i>
            <h3>Regras de Acesso aos Cursos</h3>
            
            ${cursoUsuario ? `
                <p>Ol√°, <strong>${usuarioNome}</strong>!</p>
                <p>Seu curso atual: <strong>${cursoUsuario.toUpperCase()}</strong></p>
                
                <div class="regras-lista">
                    <h4>Suas permiss√µes:</h4>
                    ${regras[cursoUsuario] ? regras[cursoUsuario].map(regra => `
                        <div class="regra-item">
                            <i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 8px;"></i>
                            ${regra}
                        </div>
                    `).join('') : `
                        <div class="regra-item">
                            <i class="fas fa-exclamation-triangle" style="color: #FF9800; margin-right: 8px;"></i>
                            Curso n√£o identificado. Contate o administrador.
                        </div>
                    `}
                </div>
                
                <p><small>Para alterar seu curso, contate o administrador do sistema.</small></p>
            ` : `
                <div class="regras-lista">
                    <h4>Regras Gerais:</h4>
                    <div class="regra-item">
                        <i class="fas fa-user-plus" style="color: #4361ee; margin-right: 8px;"></i>
                        Fa√ßa login para ver suas permiss√µes espec√≠ficas
                    </div>
                    <div class="regra-item">
                        <i class="fas fa-graduation-cap" style="color: #ffcf00; margin-right: 8px;"></i>
                        Cada curso tem acesso restrito por √°rea de estudo
                    </div>
                    <div class="regra-item">
                        <i class="fas fa-exclamation-circle" style="color: #f44336; margin-right: 8px;"></i>
                        Cursos bloqueados aparecem em cinza com badge vermelho
                    </div>
                </div>
                
                <p><small>Fa√ßa login para desbloquear os cursos dispon√≠veis para voc√™.</small></p>
            `}
            
            <button class="btn-fechar-modal" onclick="this.closest('.modal-regras').remove()">
                Entendi
            </button>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Fechar modal ao clicar fora
    modal.addEventListener('click', function(e) {
        if (e.target === this) {
            this.remove();
        }
    });
}

// ‚úÖ FUN√á√ÉO DE DEBUG
function debugLogin() {
    console.clear();
    console.log('üêõ ===== DEBUG DE LOGIN =====');
    
    // Informa√ß√µes atuais
    console.log('üìä INFORMA√á√ïES ATUAIS:');
    console.log('- Usu√°rio ID:', sistemaLogin.usuarioId);
    console.log('- Curso:', sistemaLogin.cursoUsuario);
    console.log('- Nome:', sistemaLogin.usuarioNome);
    console.log('- Logado:', sistemaLogin.estaLogado());
    
    // LocalStorage
    console.log('\nüì¶ LOCALSTORAGE:');
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        console.log(`  ${key}: ${localStorage.getItem(key)}`);
    }
    
    // SessionStorage
    console.log('\nüì¶ SESSIONSTORAGE:');
    for (let i = 0; i < sessionStorage.length; i++) {
        const key = sessionStorage.key(i);
        console.log(`  ${key}: ${sessionStorage.getItem(key)}`);
    }
    
    // Cookies
    console.log('\nüç™ COOKIES:');
    console.log('  Document cookie:', document.cookie);
    
    // Tentar recarregar credenciais
    console.log('\nüîÑ RECARREGANDO CREDENCIAIS...');
    sistemaLogin.encontrarCredenciais();
    sistemaLogin.mostrarStatusLogin();
    
    // Mostrar alerta
    mostrarAlerta('Debug executado! Verifique o console (F12).', 'warning');
}

// ‚úÖ TESTE DOS FILTROS
function testarFiltros() {
    console.log('üß™ TESTANDO FILTROS MANUALMENTE...');
    
    const filtros = ['all', 'matematica', 'csn', 'csh', 'portugues', 'programacao'];
    
    filtros.forEach(filtro => {
        const cursosFiltrados = cursos.filter(curso => 
            filtro === 'all' || curso.categoria === filtro
        );
        console.log(`Filtro "${filtro}": ${cursosFiltrados.length} cursos`);
    });
}

// ‚úÖ EXPORTAR FUN√á√ïES PARA HTML
window.iniciarCurso = iniciarCurso;
window.verDetalhes = verDetalhes;
window.voltarParaMenu = voltarParaMenu;
window.mostrarModalRegras = mostrarModalRegras;
window.irParaLogin = irParaLogin;
window.debugLogin = debugLogin;
window.testarFiltros = testarFiltros;
window.sistemaLogin = sistemaLogin;

// ‚úÖ EXECUTAR TESTE AP√ìS CARREGAR
setTimeout(() => {
    console.log('üß™ Executando teste autom√°tico dos filtros...');
    testarFiltros();
}, 2000);
</script>
    
</body>
</html>
